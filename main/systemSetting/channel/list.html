<#include "/tpl/layout.html"> <@header> </@header> <@body>
<section id="main-content">
    <section class="wrapper">
        <!-- page start-->
        <div class="row">
            <div class="col-lg-12">
                <section class="panel">
                    <header class="panel-heading">
                        渠道管理
                    </header>
                    <div class="panel-body">
                        <button type="button" class="btn btn-primary" id="add">新增</button>
                    </div>
                    <table class="table table-striped table-advance table-hover" id="sample_1">
                        <thead>
                            <tr>
                                <th style="width:8px;"><input type="checkbox" class="group-checkable"
                                                              data-set="#sample_1 .checkboxes"/></th>
                                <th class="hidden-phone">渠道代码</th>
                                <th class="hidden-phone">渠道名称</th>
                                <th class="hidden-phone">分享链接</th>
                                <th class="hidden-phone">操作</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <#if list ??>
                                <#list list as channelInfo>
                                    <tr class="odd gradeX">
                                        <td>
                                            <input type="checkbox" class="checkboxes" value="${channelInfo.id}"/>
                                        </td>
                                        <td class="hidden-phone">${channelInfo.code}</td>
                                        <td class="hidden-phone">${channelInfo.name}</td>
                                            <#if (channelInfo.link?length>40)>
                                                <td class="hidden-phone">
                                                    ${channelInfo.link?substring(0,40)}
                                                </td>
                                            <#else>
                                                <td class="hidden-phone">${channelInfo.link}</td>
                                            </#if>
                                        <td>
                                            <button class="btn btn-primary btn-xs" onclick="edit(${channelInfo.id})">修改</button>
                                            <button class="btn btn-danger btn-xs" onclick="del(${channelInfo.id})">删除</button>
                                        </td>
                                   </tr>
                                </#list>
                            </#if>
                        </tbody>
                    </table>
                    ${pagerInfo}
                </section>
            </div>
        </div>
        <!-- page end-->
    </section>
</section>
<!--main content end-->
</section>
</@body>
<@footer> </@footer>
<script src="${base}/static/common/search-param-handle.js"></script>
<script type="text/javascript">
//跳转添加页面
$("#add").click(function() {	
	window.location.href = "/admin/channel/toEdit";
});

//跳转修改页面
function edit(id){
	window.location.href = "/admin/channel/toEdit?id=" + id;
}

function del(id){
	swal({ 
		    title: "您确定要删除吗？", 
		    text: "您确定要删除这些数据？", 
		    type: "warning", 
		    showCancelButton: true, 
		    closeOnConfirm: true, 
		    confirmButtonText: "是的，我要删除", 
		    confirmButtonColor: "#ec6c62" 
		}, function() { 
			deleteBatch(id);
		});
}
//批量删除
function deleteBatch(ids)
{
	$.ajax({
		type: "POST",
		url:"/admin/channel/delete",
		data:{"ids":ids},
		dataType:"json",
		success:function(data){
			swal.close();
			if(data.resCode==0)
			{
				toastr.error(data.resMsg);
			}
			else if(data.httpCode==400)
			{
				toastr.error("删除失败，请重新删除");
			}
			else
			{
				toastr.options.onHidden = function() {
					myRefresh();
				};
				toastr.success("删除成功");
			}
		},
		error:function(e){
			toastr.error("系统异常，请联系管理员!");
    	}
	});
}

function myRefresh() {
	window.location.href = "/admin/channel/list";
}

$("body").on("click",".group-checkable",function(){
	if(this.checked){ 
	    $(".checkboxes").prop('checked', true);
	}else{ 
	    $(".checkboxes").removeAttr('checked');
	}
})

function turnPage(page){
	var params = ""
	pageList("/admin/channel/list", page, params);
}

</script>